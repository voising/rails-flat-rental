// Load all .slim file in $templateCache
// components are the form [CONTROLLER]-[ACTION]
// templates are the form [CONTROLLER]/[ACTION]
angular.module('templates', []).run([ '$templateCache', function($templateCache) {
  <%
    environment.context_class.instance_eval { include ActionView::Helpers::JavaScriptHelper }
    app_root  = File.expand_path('../', __FILE__)
    templates = File.join(app_root, %w{components ** *})
    Dir.glob(templates).each do |f|
      unless File.directory?(f)
        if f =~ /slim$/
          depend_on(f)
          key = File.basename(f).split('.').first
          # content = environment.find_asset(f).body
          content = Tilt.new(f).render
          %>
          $templateCache.put("<%= key %>", "<%= escape_javascript(content) %>" );
        <% end %>
      <% end %>
  <% end %>
  <%
    templates = File.join(app_root, %w{templates ** *})
    Dir.glob(templates).each do |f|
      unless File.directory?(f)
    if f =~ /slim$/
      depend_on(f)
    key = f.gsub(%r(^#{app_root}/templates/),'').split('.').first
            # content = environment.find_asset(f).body
    content = Tilt.new(f).render
      %>
      $templateCache.put("<%= key %>", "<%= escape_javascript(content) %>" );
    <% end %>
    <% end %>
  <% end %>
}]);
